name: Go Build (Windows Cross Compile)

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build-windows:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4

    - name: Set up Go
      uses: actions/setup-go@v5  # 升级到v5，兼容性更好
      with:
        go-version: '1.22'      # 与go.mod一致的版本（简写）
        cache: true

    - name: Install Cross Compile Dependencies (mingw-w64)
      run: |
        sudo apt-get update
        sudo apt-get install -y gcc-mingw-w64-x86-64 make  # 安装Windows交叉编译工具链

    - name: Install Go Dependencies
      run: go mod tidy

    - name: Create Build Directory
      run: mkdir -p bin  # 确保bin目录存在

    - name: Build Windows Executable (Cross Compile)
      run: make build

    # 可选：上传编译产物（方便下载）
    - name: Upload Build Artifact
      uses: actions/upload-artifact@v4
      with:
        name: cookie-windows-amd64
        path: bin/cookie.exe
